
# This file was generated by the Tkinter Designer by Parth Jadhav
# https://github.com/ParthJadhav/Tkinter-Designer


from pathlib import Path

# from tkinter import *
# Explicit imports to satisfy Flake8
from tkinter import Tk, Canvas, Entry, Text, Button, PhotoImage

import json
import subprocess
import sys

OUTPUT_PATH = Path(__file__).parent
ASSETS_PATH = OUTPUT_PATH / Path(r"G:/My Drive/Coding\DigitalQuizApp/quiz_gui\build/assets/frame1")


# --- FUNCTIONS ---
def relative_to_assets(path: str) -> Path:
    return ASSETS_PATH / Path(path)

# lodaing quiz data from JSON file
try: 
    with open("questions.json", "r") as f:
        quiz_data = json.load(f)["questions"]
except FileNotFoundError:
    print("Error: questions.json not found!")
    quiz_data = []

# creating quiz state variables
current_question_index = 0
score = 0
total_questions = len(quiz_data)

# function to open the score screen
def end_quiz():
    # saving the final score
    try: 
        with open("score.txt", "w") as f:
            f.write(f"{score}, {total_questions}")
    except Exception as e:
        print(f"Error writing score file {e}")

    window.destroy()
    python_executable = sys.executable
    subprocess.Popen([python_executable, "quiz_gui/build/gui2.py"])

# function to update text on the screen
def display_question():
    if current_question_index >= total_questions:
        end_quiz()
        return
    
    # getting current question data
    question = quiz_data[current_question_index]

    # updating text elememnts using their IDs
    canvas.itemconfig(question_text, text=question["question"])
    canvas.itemconfig(answer_text_a, text=question["options"][0])
    canvas.itemconfig(answer_text_b, text=question["options"][1])
    canvas.itemconfig(answer_text_c, text=question["options"][2])
    canvas.itemconfig(answer_text_d, text=question["options"][3])

    # updating progress text
    canvas.itemconfig(progress_text, text=f"Question {current_question_index + 1}/{total_questions}")

# function to chech the answer and load next question
def check_answer(chosen_option_index):
    global score, current_question_index  # to modify global variables

    # getting correct answer
    correct_answer = quiz_data[current_question_index]["correct_answer"]

    # getting text of chosen answer
    chosen_answer = quiz_data[current_question_index]["options"][chosen_option_index]
    
    # checking if answer is correct
    if chosen_answer == correct_answer:
        score += 1
        print(f"Correct! Score: {score}")  # only for test purposes -> getting removed
    else:
        print(f"Wrong. Score: {score}")  # only for test purposes -> getting removed

    # moving to next question
    current_question_index += 1

    # displaying next question
    display_question()

# functions to pass to buttons
def click_answer_a(event):
    check_answer(0)

def click_answer_b(event):
    check_answer(1)

def click_answer_c(event):
    check_answer(2)

def click_answer_d(event):
    check_answer(3)


# --- UI ---
window = Tk()

window.geometry("1440x1024")
window.configure(bg = "#3D3C3C")

canvas = Canvas(
    window,
    bg = "#3D3C3C",
    height = 1024,
    width = 1440,
    bd = 0,
    highlightthickness = 0,
    relief = "ridge"
)

canvas.place(x = 0, y = 0)

# --- ANSWER BUTTONS ---
# Answer Button A (Index 0)
answer_rect_a = canvas.create_rectangle(
    345.0,
    258.0,
    1095.0,
    378.0,
    fill="#746FF4",
    outline=""
)
answer_text_a = canvas.create_text(
    720.0,
    318.0,
    anchor="center",
    text="Answer A",
    fill="#FFFFFF",
    font=("Consolas", 32 * -1),
    width=700,
    justify="center"
)
canvas.tag_bind(answer_rect_a, "<Button-1>", click_answer_a)
canvas.tag_bind(answer_text_a, "<Button-1>", click_answer_a)


# Answer Button B (Index 1)
answer_rect_b = canvas.create_rectangle(
    345.0,
    427.0,
    1095.0,
    547.0,
    fill="#746FF4",
    outline=""
)
answer_text_b = canvas.create_text(
    720.0,
    487.0,
    anchor="center",
    text="Answer B",
    fill="#FFFFFF",
    font=("Consolas", 32 * -1),
    width=700,
    justify="center"
)
canvas.tag_bind(answer_rect_b, "<Button-1>", click_answer_b)
canvas.tag_bind(answer_text_b, "<Button-1>", click_answer_b)


# Answer Button C (Index 2)
answer_rect_c = canvas.create_rectangle(
    345.0,
    596.0,
    1095.0,
    716.0,
    fill="#746FF4",
    outline=""
)
answer_text_c = canvas.create_text(
    720.0,
    656.0,
    anchor="center",
    text="Answer C",
    fill="#FFFFFF",
    font=("Consolas", 32 * -1),
    width=700,
    justify="center"
)
canvas.tag_bind(answer_rect_c, "<Button-1>", click_answer_c)
canvas.tag_bind(answer_text_c, "<Button-1>", click_answer_c)

# Answer Button D (Index 3)
answer_rect_d = canvas.create_rectangle(
    345.0,
    765.0,
    1095.0,
    885.0,
    fill="#746FF4",
    outline=""
)
answer_text_d = canvas.create_text(
    720.0,
    825.0,
    anchor="center",
    text="Answer D",
    fill="#FFFFFF",
    font=("Consolas", 32 * -1),
    width=700,
    justify="center"
)
canvas.tag_bind(answer_rect_d, "<Button-1>", click_answer_d)
canvas.tag_bind(answer_text_d, "<Button-1>", click_answer_d)

# --- UI TEXT ELEMENTS --- 
progress_text = canvas.create_text(
    1193.0,
    57.0,
    anchor="nw",
    text="Question 1/10",
    fill="#A0A0A0",
    font=("Consolas", 24 * -1)
)

question_text = canvas.create_text(
    47.0,
    77.0,
    anchor="nw",
    text="What is the capital of France?",
    fill="#FFFFFF",
    font=("Consolas", 40 * -1),
    width=1150
)

display_question()

window.resizable(True, True)
window.mainloop()